// src/App.js
import React from "react";
import { BrowserRouter as Router, Routes, Route } from "react-router-dom";
import Navbar from "./components/Navbar";
import EmployeeList from "./components/EmployeeList";
import AddEmployee from "./components/AddEmployee";
import DepartmentList from "./components/DepartmentList";
import AddDepartment from "./components/AddDepartment";

function App() {
  return (
    <Router>
      <Navbar />
      <div className="container mt-4">
        <Routes>
          <Route path="/" element={<EmployeeList />} />
          <Route path="/employees" element={<EmployeeList />} />
          <Route path="/add-employee" element={<AddEmployee />} />
          <Route path="/edit-employee/:id" element={<AddEmployee />} />
          <Route path="/departments" element={<DepartmentList />} />
          <Route path="/add-department" element={<AddDepartment />} />
          <Route path="/edit-department/:id" element={<AddDepartment />} />
        </Routes>
      </div>
    </Router>
  );
}

export default App;

// src/components/Navbar.js
import React from "react";
import { Link } from "react-router-dom";

const Navbar = () => (
  <nav className="navbar navbar-expand-lg navbar-dark bg-dark">
    <div className="container-fluid">
      <Link className="navbar-brand" to="/">EmployeeDeptApp</Link>
      <div className="collapse navbar-collapse">
        <ul className="navbar-nav">
          <li className="nav-item">
            <Link className="nav-link" to="/employees">Employees</Link>
          </li>
          <li className="nav-item">
            <Link className="nav-link" to="/departments">Departments</Link>
          </li>
        </ul>
      </div>
    </div>
  </nav>
);

export default Navbar;

// src/components/EmployeeList.js
import React, { useEffect, useState } from "react";
import { Link } from "react-router-dom";
import axios from "axios";

const EmployeeList = () => {
  const [employees, setEmployees] = useState([]);

  const fetchEmployees = async () => {
    const res = await axios.get("http://localhost:8080/api/employees");
    setEmployees(res.data);
  };

  useEffect(() => {
    fetchEmployees();
  }, []);

  const deleteEmployee = async (id) => {
    await axios.delete(`http://localhost:8080/api/employees/${id}`);
    fetchEmployees();
  };

  return (
    <div>
      <h2>Employees</h2>
      <Link to="/add-employee" className="btn btn-primary mb-2">Add Employee</Link>
      <table className="table table-bordered">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Designation</th>
            <th>Department</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {employees.map((emp) => (
            <tr key={emp.id}>
              <td>{emp.name}</td>
              <td>{emp.email}</td>
              <td>{emp.designation}</td>
              <td>{emp.department?.name || "N/A"}</td>
              <td>
                <Link to={`/edit-employee/${emp.id}`} className="btn btn-warning btn-sm me-2">Edit</Link>
                <button onClick={() => deleteEmployee(emp.id)} className="btn btn-danger btn-sm">Delete</button>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
};

export default EmployeeList;

// src/components/AddEmployee.js
import React, { useState, useEffect } from "react";
import { useNavigate, useParams } from "react-router-dom";
import axios from "axios";

const AddEmployee = () => {
  const [employee, setEmployee] = useState({ name: "", email: "", designation: "", departmentId: "" });
  const [departments, setDepartments] = useState([]);
  const { id } = useParams();
  const navigate = useNavigate();

  const loadDepartments = async () => {
    const res = await axios.get("http://localhost:8080/api/departments");
    setDepartments(res.data);
  };

  const loadEmployee = async () => {
    if (id) {
      const res = await axios.get(`http://localhost:8080/api/employees/${id}`);
      setEmployee(res.data);
    }
  };

  useEffect(() => {
    loadDepartments();
    loadEmployee();
  }, [id]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (id) {
      await axios.put(`http://localhost:8080/api/employees/${id}`, employee);
    } else {
      await axios.post("http://localhost:8080/api/employees", employee);
    }
    navigate("/employees");
  };

  return (
    <form onSubmit={handleSubmit}>
      <h2>{id ? "Edit" : "Add"} Employee</h2>
      <input className="form-control mb-2" placeholder="Name" value={employee.name} onChange={(e) => setEmployee({ ...employee, name: e.target.value })} required />
      <input className="form-control mb-2" placeholder="Email" value={employee.email} onChange={(e) => setEmployee({ ...employee, email: e.target.value })} required />
      <input className="form-control mb-2" placeholder="Designation" value={employee.designation} onChange={(e) => setEmployee({ ...employee, designation: e.target.value })} required />
      <select className="form-control mb-2" value={employee.departmentId} onChange={(e) => setEmployee({ ...employee, departmentId: e.target.value })} required>
        <option value="">Select Department</option>
        {departments.map((dept) => (
          <option key={dept.id} value={dept.id}>{dept.name}</option>
        ))}
      </select>
      <button className="btn btn-success">Save</button>
    </form>
  );
};

export default AddEmployee;

// src/components/DepartmentList.js
import React, { useEffect, useState } from "react";
import { Link } from "react-router-dom";
import axios from "axios";

const DepartmentList = () => {
  const [departments, setDepartments] = useState([]);

  const fetchDepartments = async () => {
    const res = await axios.get("http://localhost:8080/api/departments");
    setDepartments(res.data);
  };

  useEffect(() => {
    fetchDepartments();
  }, []);

  const deleteDepartment = async (id) => {
    await axios.delete(`http://localhost:8080/api/departments/${id}`);
    fetchDepartments();
  };

  return (
    <div>
      <h2>Departments</h2>
      <Link to="/add-department" className="btn btn-primary mb-2">Add Department</Link>
      <table className="table table-bordered">
        <thead>
          <tr>
            <th>Name</th>
            <th>Location</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {departments.map((dept) => (
            <tr key={dept.id}>
              <td>{dept.name}</td>
              <td>{dept.location}</td>
              <td>
                <Link to={`/edit-department/${dept.id}`} className="btn btn-warning btn-sm me-2">Edit</Link>
                <button onClick={() => deleteDepartment(dept.id)} className="btn btn-danger btn-sm">Delete</button>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
};

export default DepartmentList;

// src/components/AddDepartment.js
import React, { useState, useEffect } from "react";
import { useNavigate, useParams } from "react-router-dom";
import axios from "axios";

const AddDepartment = () => {
  const [department, setDepartment] = useState({ name: "", location: "" });
  const { id } = useParams();
  const navigate = useNavigate();

  useEffect(() => {
    if (id) {
      axios.get(`http://localhost:8080/api/departments/${id}`).then((res) => {
        setDepartment(res.data);
      });
    }
  }, [id]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (id) {
      await axios.put(`http://localhost:8080/api/departments/${id}`, department);
    } else {
      await axios.post("http://localhost:8080/api/departments", department);
    }
    navigate("/departments");
  };

  return (
    <form onSubmit={handleSubmit}>
      <h2>{id ? "Edit" : "Add"} Department</h2>
      <input className="form-control mb-2" placeholder="Name" value={department.name} onChange={(e) => setDepartment({ ...department, name: e.target.value })} required />
      <input className="form-control mb-2" placeholder="Location" value={department.location} onChange={(e) => setDepartment({ ...department, location: e.target.value })} required />
      <button className="btn btn-success">Save</button>
    </form>
  );
};

export default AddDepartment;